{% extends "base.html" %}
{% block title %}Events Calendar{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">Events Calendar</h2>
    <div id="calendar"></div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var calendarEl = document.getElementById("calendar");

        fetch("/events/data/")  // Fetch event data
            .then(response => response.json())
            .then(events => {
                if (events.length === 0) {
                    showNoEventsPopup();  // Show a soft pop-up
                }

                var formattedEvents = events.map(event => ({
                    title: event.title + "\n" + event.description,  // Display title and description
                    start: event.date,
                    extendedProps: { description: event.description } // Extra event details
                }));

                var calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: "dayGridMonth",
                    events: formattedEvents,
                    eventClick: function(info) {
                        showEventPopup(info.event.title, info.event.extendedProps.description);
                    }
                });

                calendar.render();
            })
            .catch(error => console.error("Error fetching events: ", error));

        // Function to show event pop-up
        function showEventPopup(title, description) {
            document.getElementById("eventTitle").innerText = title;
            document.getElementById("eventDescription").innerText = description;
            document.getElementById("eventModal").style.display = "block";
        }

        // Function to show 'No Events' pop-up
        function showNoEventsPopup() {
            document.getElementById("noEventsModal").style.display = "block";
        }

        // Function to close modals
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }
    });
</script>
