{% extends "base.html" %}
{% block title %}Forum Posts{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">Forum Posts</h2>
    {% for post in posts %}
        <div class="card my-3">
            <div class="card-body">
                <h4 class="card-title">{{ post.title }}</h4>
                <p class="card-text">{{ post.content }}</p>

                <!-- Separate Author Box -->
                <div class="alert alert-secondary p-2">
                    <strong>Posted by:</strong> {{ post.author|default:"Anonymous" }}
                </div>

                <h5>Comments:</h5>
                <ul class="list-group">
                    {% for comment in post.comments.all %}
                        <li class="list-group-item">
                            <div class="fw-bold"> {{ comment.author|default:"Anonymous" }} </div>
                            {{ comment.content }}
                        </li>
                    {% empty %}
                        <li class="list-group-item">No comments yet.</li>
                    {% endfor %}
                </ul>

                <h5 class="mt-3">Add a Comment:</h5>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="post_id" value="{{ post.id }}">

                    <label for="author">Your Name (Optional):</label>
                    <input type="text" class="form-control mb-2" name="author" id="author">

                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="anonymousCheck">
                        <label class="form-check-label" for="anonymousCheck">Post as Anonymous</label>
                    </div>

                    <textarea class="form-control mt-2" name="comment_content" required></textarea>
                    <button class="btn btn-primary mt-2">Post Comment</button>
                </form>
            </div>
        </div>
    {% empty %}
        <p class="text-center">No posts available.</p>
    {% endfor %}
</div>

<script>
    // If "Post as Anonymous" is checked, clear the author field
    document.getElementById('anonymousCheck').addEventListener('change', function() {
        if (this.checked) {
            document.getElementById('author').value = '';
            document.getElementById('author').disabled = true;
        } else {
            document.getElementById('author').disabled = false;
        }
    });
</script>
{% endblock %}
